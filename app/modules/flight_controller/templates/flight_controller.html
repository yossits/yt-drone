{% extends "base.html" %} {% block title %}YT-Drone{% endblock %} {% block content %}

<div class="grid grid-2">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Flight Controller</h3>
    </div>
    <div class="card-body">
      <div class="form-container">

        <!-- Connection Type -->
        <div class="form-group">
          <label class="form-label">Connection Type</label>
          <select class="form-select">
            <option value="serial">Serial connection</option>
            <option value="usb">USB connection</option>
          </select>
        </div>

        <!-- Baud Rate -->
        <div class="form-group">
          <label class="form-label">Baud Rate</label>
          <select class="form-select">
            <option value="9600">9600</option>
            <option value="57600" selected>57600</option>
            <option value="115200">115200</option>
          </select>
          <p style="font-size: 0.85em; color: var(--text-secondary); margin-top: 4px;">Default baudrate is 57600</p>
        </div>

        <!-- FC Internal Address -->
        <div class="form-group">
          <label class="form-label">FC Internal Address</label>
          <p style="font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;">Internal address for Flight Controller communication</p>
          <input type="text" class="form-input" value="/dev/ttyAMA0">
          <p style="font-size: 0.85em; color: var(--text-secondary); margin-top: 8px;">This is the internal address Raspberry Pi uses for communication with the Flight Controller. Only change if you know what you are doing!</p>
        </div>
      </div>

      <!-- Buttons -->
      <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
        <button class="btn btn-warning" id="fc-connect-restart-btn">
          Restart
        </button>
        <button class="btn btn-danger" id="fc-disconnect-btn">
          Disconnect
        </button>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Mavlink Inspector</h3>
    </div>
    <div class="card-body">

    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <p>
      <em
        >כאן יוצגו נתונים של יומן פעולות</em
      >
    </p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  const connectRestartBtn = document.getElementById("fc-connect-restart-btn");
  const disconnectBtn = document.getElementById("fc-disconnect-btn");
  
  // Function to update buttons based on FC connection status
  function updateFCButtons(connected) {
    if (!connectRestartBtn || !disconnectBtn) return;
    
    if (connected) {
      // FC is connected
      // Disconnect button: disabled with opacity
      disconnectBtn.disabled = true;
      disconnectBtn.classList.add("fc-disconnect-disabled");
      disconnectBtn.style.opacity = "0.5";
      disconnectBtn.style.cursor = "not-allowed";
      
      // Restart button: stays as "Restart"
      connectRestartBtn.textContent = "Restart";
    } else {
      // FC is not connected
      // Disconnect button: enabled, normal opacity
      disconnectBtn.disabled = false;
      disconnectBtn.classList.remove("fc-disconnect-disabled");
      disconnectBtn.style.opacity = "1";
      disconnectBtn.style.cursor = "pointer";
      
      // Restart button: changes to "Connect"
      connectRestartBtn.textContent = "Connect";
    }
  }
  
  // Function to load FC status from server
  function loadFCStatus() {
    fetch("/flight-controller/status")
      .then(response => response.json())
      .then(data => {
        updateFCButtons(data.connected || false);
      })
      .catch(error => {
        console.error("Error loading FC status:", error);
        // Default to disconnected on error
        updateFCButtons(false);
      });
  }
  
  // Load status on page load
  loadFCStatus();
  
  // Update status periodically (every 5 seconds)
  setInterval(loadFCStatus, 5000);
});
</script>
{% endblock %}
